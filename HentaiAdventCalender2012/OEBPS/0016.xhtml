<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
<title>day15</title>
<link rel="stylesheet" href="css/default.css" type="text/css" />
</head>
<body>
<h3>day15</h3>
<h1>2012-12-15 IRC botでHENTAIを通報する！</h1><br/>
<br/>
この記事はHENTAI Advent Calendar 2012 - 変態アドベントカレンダー 15日目の記事です。<br/>
<img src="images/__________2012-11-03_23.31.02_original.png" alt="画像1" /><br/>
<br/>
昨日は<a href="https://twitter.com/issps2009">@issps2009</a>さんの素晴らしいエントリー(<a href="http://d.hatena.ne.jp/issan2009/20121214">http://d.hatena.ne.jp/issan2009/20121214</a>)でした！<br/>
<br/>
アドベントカレンダーに書くのは初めてだったりします。<br/>
<br/>
初めてが変態だなんて…というネタでエントリが1つ書けてしまうかもしれませんが、やめときます。<br/>
<br/>
昨年、我らが総帥<a href="https://twitter.com/daiksy">@daiksy</a>さんがTwitter botで変態を通報しておられました。<br/>
<br/>
<a href="http://daiksy.blogspot.jp/2011/11/twitter.html">http://daiksy.blogspot.jp/2011/11/twitter.html</a><br/>
<br/>
ということで、僕はIRCで変態を監視することにします。<br/>
<br/>
<h2>IRC botは簡単に書けるよ！そう、Rubyならね！</h2><br/>
<br/>
「ruby irc bot」と検索すると、いともたやすく検索できてしまいました。こちらはミサワ先輩のありがたいお言葉を頂戴するボットです。<br/>
<br/>
UKSTUDIO - IRCでミサワをいつも側に…<br/>
<br/>
<a href="http://ukstudio.jp/2010/12/24/misawa-ruby-recipe/">http://ukstudio.jp/2010/12/24/misawa-ruby-recipe/</a><br/>
<br/>
これを変えさせてもらって、変態を通報するようにします。noticeだと隠れてしまうので、堂々とprivate messageで通報します。<br/>
<br/>
<figure id="code15-1"><pre><code class="ruby">
# coding: utf-8
require &apos;rubygems&apos;
require &apos;net/irc&apos;

class HentaiPatroler &lt; Net::IRC::Client
  def on_rpl_welcome(m)
    post JOIN, opts.channel
  end

  def on_privmsg(m)
    channel, message = *m
    if message.force_encoding(&apos;utf-8&apos;) =~ /変態/
      post PRIVMSG, channel, &apos;↑ お巡りさん、この人です！&apos;
    end
  end

end

patroler = HentaiPatroler.new([サーバ名], [ポート番号],
                          {:nick =&gt; &apos;patrol&apos;, :user =&gt; &apos;patrol&apos;, :real =&gt; &apos;patrol&apos;,
                           :channel =&gt; &apos;#channel&apos;})
patroler.start
</code></pre></figure>
<br/>
<h2>起動</h2><br/>
<br/>
<figure id="code15-2"><pre><code class="ruby">
ruby HentaiPatroler.rb
</code></pre></figure>
<br/>
すると、「変態」と書き込んだ瞬間、間髪入れずに通報することができます。<br/>
<br/>
<img src="images/20121213173511.png" alt="画像1" /><br/>
<br/>
お粗末さまでした。<br/>
<br/>
<h2>ところでみなさんのIRCクライアントは？</h2><br/>
<br/>
LimeChatが一番シェアが多いように感じます。でも、「GUIよりCUI」を僕は心がけているので、IRCクライアントもCUIです。<br/>
<br/>
WeeChat, the extensible chat client <a href="http://www.weechat.org/">http://www.weechat.org/</a><br/>
<br/>
最初は不便を感じましたが、普段GUIで済ませていて意識しないこと、たとえばIRCコマンドを覚えたりするので、やはりCUIは偉大です。<br/>
<br/>
<h2>ところでIRCサーバーは？</h2><br/>
<a href="http://ngircd.barton.de/">ngIRCd: Next Generation IRC Daemon</a>でサクッと立てました。Ubuntuだとaptで入るので、楽勝です。<br/>
<br/>
<h2>明日は</h2><br/>
<br/>
<a href="https://twitter.com/s_kozake">@s_kozake</a>さんです！お楽しみに！<br/>
<br/>

</body>
</html>

